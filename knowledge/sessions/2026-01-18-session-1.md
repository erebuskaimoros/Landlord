# Session 1 - iOS Simulator Setup & Offline Cache Fix

> Date: 2026-01-18
> Focus: Setting up iOS Simulator for mobile app testing and fixing offline sync error

## Summary

Set up Xcode and iOS Simulator to test the React Native mobile app locally. After getting the app running in the simulator, discovered and fixed a SQLite constraint error in the offline caching system where the `cacheData` function wasn't populating required columns for the `cached_leases` table.

## Work Done

- Started Next.js web dev server (wasn't running)
- Installed Xcode from App Store and configured `xcode-select`
- Downloaded iOS 26.2 simulator runtime
- Configured Expo to use `127.0.0.1` instead of LAN IP for simulator
- Ran Expo with `REACT_NATIVE_PACKAGER_HOSTNAME=127.0.0.1` for local simulator
- Diagnosed offline sync error: `NOT NULL constraint failed: cached_leases.unit_id`
- Fixed `cacheData` function to handle leases and tasks tables specially

## Discoveries

- **iOS Simulator requires full Xcode**: Command Line Tools alone aren't enough; need full Xcode app plus simulator runtime download (~12GB + ~5-7GB)
- **Simulator uses localhost**: Physical iPhone needs LAN IP (10.0.0.x), but simulator can use 127.0.0.1 directly
- **Generic cache function issue**: The `cached_leases` and `cached_tasks` tables have extra required columns (unit_id, tenant_id, status, priority, due_date) that the generic `cacheData` function wasn't populating
- **Expo non-interactive mode**: Running Expo from background processes fails when prompts appear; must run interactively in terminal

## Files Changed

| File | Change |
|------|--------|
| mobile/.env | Changed SUPABASE_URL from LAN IP to 127.0.0.1 for simulator |
| mobile/src/lib/offline/database.ts | Fixed cacheData() to handle leases and tasks with their specific required columns |

## In Progress

- App reloading in simulator after fix
- May need to clear simulator app data if old corrupted SQLite database persists

## Next Steps

- [ ] Verify app loads successfully after fix
- [ ] Test login flow with e2e-test@example.com credentials
- [ ] Test offline sync functionality
- [ ] Reset mobile/.env back to LAN IP when testing on physical iPhone
- [ ] Consider adding database migration to handle schema changes gracefully
