# Session 2 - Task Photos Feature

> Date: 2026-01-18
> Focus: Add photo upload/viewing functionality to task detail pages

## Summary

Implemented the task photos feature allowing users to upload and view photos on task detail pages. Photos uploaded to tasks are automatically tagged with the task's associated unit, so they appear in both the task view and the unit's maintenance photos tab. This completes a key piece of the maintenance documentation workflow.

## Work Done

- Added `getPhotosByTask(taskId)` function to the photos service
- Created task photo server actions (`uploadTaskPhotoAction`, `deleteTaskPhotoAction`) with dual path revalidation
- Built `TaskPhotoSection` component with photo grid, upload dialog, viewer with navigation, and delete capability
- Updated task detail server component to fetch photos and generate signed URLs
- Updated task detail client component to render the photo section between Cost Information and Notes

## Discoveries

- Task photos use a nested storage path pattern: `{org}/{unit}/tasks/{task}/{filename}` to keep them organized
- Dual revalidation is needed when task photos affect both task and unit pages
- Task photos always use `maintenance` event type since they're documenting work on tasks

## Files Changed

| File | Change |
|------|--------|
| `app/src/services/photos.ts` | Added `getPhotosByTask()` function |
| `app/src/app/(dashboard)/tasks/[id]/photo-actions.ts` | Created with upload and delete server actions |
| `app/src/components/photos/task-photo-section.tsx` | Created photo gallery component for tasks |
| `app/src/app/(dashboard)/tasks/[id]/page.tsx` | Added photo fetching and signed URL generation |
| `app/src/app/(dashboard)/tasks/[id]/task-detail-client.tsx` | Added TaskPhotoSection to render |

## In Progress

None - session complete

## Next Steps

- [ ] Test photo upload on a task detail page at `/tasks/{id}`
- [ ] Verify photos appear in both task view and associated unit's maintenance tab
- [ ] Test photo viewer navigation (prev/next)
- [ ] Test delete functionality as owner
- [ ] Consider adding photo count to task list view
