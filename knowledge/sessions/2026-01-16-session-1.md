# Session 1 - Mobile App Testing on iPhone

> Date: 2026-01-16
> Focus: Setting up and running the mobile app on a physical iPhone device

## Summary

Configured the Expo mobile app to run on a physical iPhone for testing. Fixed an expo-sqlite web compatibility issue by creating platform-specific stub files, configured environment variables for the local Supabase connection, and worked through various Expo Go connectivity challenges including LAN mode and tunnel mode.

## Work Done

- Created `mobile/.env` with Supabase credentials pointing to local instance (using Mac's LAN IP 10.0.0.249)
- Fixed expo-sqlite web bundling error by creating platform-specific files:
  - `database.web.ts` - stub implementation for web
  - `sync-queue.web.ts` - stub implementation for web
- Restored original `database.ts` and `sync-queue.ts` for native platforms
- Installed `@expo/ngrok` globally for tunnel mode support
- Tried multiple Expo server configurations (LAN mode, tunnel mode) to connect iPhone
- Generated QR codes for Expo Go scanning
- Successfully connected iPhone to app (user ran Expo manually in terminal)

## Discoveries

- **expo-sqlite doesn't work on web**: The WebAssembly module fails to resolve in Metro bundler. Solution is to use `.web.ts` platform-specific files with no-op stubs
- **Expo background mode limitations**: Running `npx expo start` in background mode fails when any interactive input is required (e.g., keyboard shortcuts, prompts)
- **LAN connectivity requires correct hostname**: Must set `REACT_NATIVE_PACKAGER_HOSTNAME` env var to Mac's LAN IP, otherwise manifest URLs point to 127.0.0.1
- **Expo Go on iPhone**: No manual URL entry - must scan QR code with Camera app, which opens Expo Go automatically
- **Test credentials**: `e2e-test@example.com` / `testpassword123`

## Files Changed

| File | Change |
|------|--------|
| mobile/.env | Created with Supabase URL (LAN IP) and anon key |
| mobile/src/lib/offline/database.web.ts | Created web stub (no-op implementations) |
| mobile/src/lib/offline/sync-queue.web.ts | Created web stub (no-op implementations) |
| mobile/src/lib/offline/database.ts | Restored to original (native-only) |
| mobile/src/lib/offline/sync-queue.ts | Restored to original (native-only) |

## In Progress

- User has app running on iPhone via Expo Go
- Login screen displayed, credentials provided

## Next Steps

- [ ] Test login flow on mobile with e2e-test@example.com credentials
- [ ] Verify data loads correctly from local Supabase
- [ ] Test photo capture and geolocation features
- [ ] Test offline mode and sync queue functionality
- [ ] Consider creating a development build for full native feature access
